<HTML>
<CENTER><A HREF = "Minnows.html">Previous Section</A> - <A HREF = "http://phish.sandia.gov">PHISH WWW Site</A> -
<A HREF = "Manual.html">LAMMPS Documentation</A> - <A HREF = "Examples.html">Next Section</A> 
</CENTER>




<HR>

<H3>4. PHISH Library 
</H3>
<P>This is the API to the PHISH library that minnows (stand-alone
applications) call.  It is a C-style API, so it is easy to write
minnows in any language (e.g. C, C++, Fortran, Python) that call the
PHISH library.  The doc pages below for individual library functions
also document the <A HREF = "Python.html">Python interface</A> to the library.
</P>
<P>NOTE: Is the Sockets interface identical?
NOTE: Discuss limits and options affecting library:
      e.g. MAXBUF and PHISH_SAFE_SEND
      make these user-settable options?
</P>
<P>PHISH minnows communicate with other minnows by sending and receiving
datums.  Before looking individual library calls, its helpful to
understand how the data in a datum is structured by the PHISH library.
This topic is discussed below, in the section entitled <A HREF = "#datum">Format of a
datum</A>.
</P>
<P>The PHISH library is not large; there are only a handful of calls.
They can be grouped into the following 5 categories.  Follow the links
to see a doc page for each library call.  A general discussion of how
minnows call these functions is given in the <A HREF = "Minnows.html">Minnows</A>
section of the manual.
</P>
<OL><LI>Library calls for initialization 

<UL>  <A HREF = "phish_init.html">phish_init()</A> 
<BR>
  <A HREF = "phish_port.html">phish_input()</A> 
<BR>
  <A HREF = "phish_port.html">phish_output()</A> 
<BR>
  <A HREF = "phish_port.html">phish_done()</A> 
<BR>
  <A HREF = "phish_check.html">phish_check()</A> 
<BR></UL>
<LI>Library calls for shutdown 

<UL>  <A HREF = "phish_exit.html">phish_exit()</A> 
<BR>
  <A HREF = "phish_close.html">phish_close()</A> 
<BR></UL>
<LI>Library calls for receiving datums 

<UL>  <A HREF = "phish_loop.html">phish_loop()</A> 
<BR>
  <A HREF = "phish_probe.html">phish_probe()</A> 
<BR>
  <A HREF = "phish_recv.html">phish_recv()</A> 
<BR>
  <A HREF = "phish_unpack.html">phish_unpack()</A> 
<BR>
  <A HREF = "phish_unpack.html">phish_datum()</A> 
<BR></UL>
<LI>Library calls for sending datums 

<UL>  <A HREF = "phish_send.html">phish_send()</A> 
<BR>
  <A HREF = "phish_send.html">phish_send_key()</A> 
<BR>
  <A HREF = "phish_send.html">phish_send_direct()</A> 
<BR>
  <A HREF = "phish_pack.html">phish_pack_datum()</A> 
<BR>
  <A HREF = "phish_pack.html">phish_pack_raw()</A> 
<BR>
  <A HREF = "phish_pack.html">phish_pack_byte()</A> 
<BR>
  <A HREF = "phish_pack.html">phish_pack_int()</A> 
<BR>
  <A HREF = "phish_pack.html">phish_pack_uint64()</A> 
<BR>
  <A HREF = "phish_pack.html">phish_pack_double()</A> 
<BR>
  <A HREF = "phish_pack.html">phish_pack_string()</A> 
<BR>
  <A HREF = "phish_pack.html">phish_pack_int_array()</A> 
<BR>
  <A HREF = "phish_pack.html">phish_pack_uint64_array()</A> 
<BR>
  <A HREF = "phish_pack.html">phish_pack_double_array()</A> 
<BR></UL>
<LI>Miscellaneous library calls 

<UL>  <A HREF = "phish_init.html">phish_school()</A> 
<BR>
  <A HREF = "phish_reset_receiver.html">phish_reset_receiver()</A> 
<BR>
  <A HREF = "phish_error.html">phish_error()</A> 
<BR>
  <A HREF = "phish_error.html">phish_warn()</A> 
<BR>
  <A HREF = "phish_timer.html">phish_timer()</A> 
<BR></UL>

</OL>
<HR>

<HR>

<A NAME = "datum"></A><H4>Format of a datum 
</H4>
<P>A datum is a chunk of bytes sent from one PHISH minnow to another.
This section describes the format of the chunk, which is the same whether
the datum is sent via MPI or via sockets.
</P>
<UL><LI># of fields in datum (int)
<LI>type of 1st field (int)
<LI>size of 1st field (optional int)
<LI>data for 1st field (bytes)
<LI>type of 2nd field (int)
<LI>size of 2nd field (optional int)
<LI>data for 2nd field (bytes)
<LI>...
<LI>type of Nth field (int)
<LI>size of Nth field (optional int)
<LI>data for Nth field (bytes) 
</UL>
<P>The "type" values are one of these settings, as defined in src/phish.h:
</P>
<UL><LI>PHISH_RAW = 0
<LI>PHISH_BYTE = 1
<LI>PHISH_INT = 2
<LI>PHISH_UINT64 = 3
<LI>PHISH_DOUBLE = 4
<LI>PHISH_STRING = 5
<LI>PHISH_INT_ARRAY = 6
<LI>PHISH_UINT64_ARRAY = 7
<LI>PHISH_DOUBLE_ARRAY = 8 
</UL>
<P>PHISH_RAW is a string of raw bytes, which can be of any length, and
which the minnow can format in any manner.  PHISH_BYTE, PHISH_INT,
PHISH_UINT64, and PHISH_DOUBLE are a single byte, int, uint64, and
double value.  PHISH_INT is a signed int, typically 32-bits in length.
PHISH_UINT64 is an unsigned 64-bit int.  PHISH_STRING is a standard
C-style NULL-terminated C-string.  The NULL is included in the field.
The ARRAYS are contiguous sequences of int, uint64 or double values.
</P>
<P>The "size" values are only included for PHISH_RAW (# of bytes),
PHISH_STRING (# of bytes including NULL), and the ARRAY types (# of
values).
</P>
<P>The field data is packed into the datum in a contiguous manner.
This means that no attention is paid to alignment of integer
or floating point values.
</P>
<P>The maximum allowed size of an entire datum (in bytes) is set by
MAXBUF in src/phish.cpp, which defaults to 1 Mbyte.
</P>
<P>NOTE: should this be a user-settable parameter
</P>
<P>When a datum is sent via the MPI version of the PHISH library, MPI
flags the message with an MPI "tag".  This tag encodes the receiving
minnow's input port and also a "done" flag.  Specifically, if the
datum is not a done message, the tag is the receiver's input port (0
to Nport-1).  For a done message a value of MAXPORT (defined at the
top of src/phish.cpp) is added to the tag.
</P>
<P>See the <A HREF = "phish_port.html">phish_input</A> doc page for a discussion of
ports.  See the <A HREF = "Minnows.html#shutdown">shutdown section</A> of the
<A HREF = "Minnows.html">Minnows</A> doc page for a discussion of "done" messages.
</P>
<P>NOTE: How is this encoding of port and done implemented for sockets?
</P>
</HTML>
